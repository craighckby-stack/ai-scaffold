<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Dalek Linear Evolution v19.0</title><script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script><script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet"><style>body{background-color:#050505;color:#e5e7eb;font-family:'Fira Code',monospace}.dalek-glow{box-shadow:0 0 15px rgba(220,38,38,.4)}.terminal-scroll::-webkit-scrollbar{width:4px}.terminal-scroll::-webkit-scrollbar-track{background:#0a0a0a}.terminal-scroll::-webkit-scrollbar-thumb{background:#374151;border-radius:2px}.scanline{width:100%;height:2px;background:rgba(220,38,38,.1);position:absolute;top:0;z-index:10;pointer-events:none;animation:scan 4s linear infinite}@keyframes scan{0%{top:0}100%{top:100%}}</style></head><body><div id="root"></div><script type="text/babel">const {useState:S,useEffect:E,useRef:R,useCallback:C} = React;
const X={Cpu:()=><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2" /><path d="M9 9h6v6H9zM9 1v3M15 1v3M9 20v3M15 20v3M20 9h3M20 15h3M1 9h3M1 15h3"/></svg>,Play:()=><svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>,Square:()=><svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="1"/></svg>,Settings:()=><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,History:()=><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,Activity:()=><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>};
const O="craighckby-stack",N="ai-scaffold",B_R=`${O}/${N}`,ML=100,MF=5,S_GH='dalek_gh_token',S_GM='dalek_gemini_key',A_BASE='https://api.github.com';

// Optimized Log Item Component (Memoized for performance)
const LItem=React.memo(({log:{type:T,time:t,msg:m}})=>{
    const c={'error':'text-red-500','success':'text-green-400','warning':'text-yellow-500','info':'text-blue-300'}[T]||'';
    return <div className={`text-[11px] flex gap-3 animate-in fade-in slide-in-from-left-2`}><span className="text-gray-700 shrink-0">[{t}]</span><span className={c}>{m}</span></div>
});

// Optimized Configuration Modal (Extracted to prevent re-creation on App render)
const CfgM=({G,M,sG,sM,sCfg})=>{
    const hG=e=>{sG(e.target.value);localStorage.setItem(S_GH,e.target.value)};
    const hM=e=>{sM(e.target.value);localStorage.setItem(S_GM,e.target.value)};
    return (<div className="absolute inset-0 bg-black/90 backdrop-blur-xl z-50 flex items-center justify-center p-6"><div className="w-full max-w-md bg-[#0a0a0a] border border-red-900/50 p-8 rounded-lg shadow-2xl dalek-glow"><h2 className="text-red-600 text-lg font-black tracking-tighter mb-6 uppercase">System Identity Matrix</h2><div className="space-y-4"><div><label className="text-[10px] text-gray-500 uppercase font-bold block mb-1">GitHub PAT (repo scope)</label><input type="password" value={G} onChange={hG} placeholder="ghp_****************" className="w-full bg-black border border-gray-800 rounded p-3 text-xs text-red-500 outline-none focus:border-red-600 transition-colors" /></div><div><label className="text-[10px] text-gray-500 uppercase font-bold block mb-1">Gemini AI Key</label><input type="password" value={M} onChange={hM} placeholder="AIza****************" className="w-full bg-black border border-gray-800 rounded p-3 text-xs text-red-500 outline-none focus:border-red-600 transition-colors" /></div><button onClick={()=>sCfg(false)} className="w-full bg-red-600 text-white py-3 rounded text-xs font-bold uppercase mt-4">Validate & Synchronize</button></div></div></div>);
};

// Utility function (no state dependency)
const b64=s=>btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(m,p1)=>String.fromCharCode('0x'+p1)));

const App=()=>{
    // State initialization is condensed
    const [L,sL]=S([]),[A,sA]=S(false),[G,sG]=S(localStorage.getItem(S_GH)||''),[M,sM]=S(localStorage.getItem(S_GM)||''),[I,sI]=S(0),[B,sB]=S(''),[Cfg,sCfg]=S(false),[F,sF]=S([]);
    const A_ref=R(false),L_ref=R(null);
    
    // aL: Add Log - Memoized callback for stable logging function across renders
    const aL=C((m,t='info')=>{sL(p=>[...p,{id:Date.now()+Math.random(),msg:m,type:t,time:new Date().toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit'})}].slice(-ML))},[]);
    
    // Effect for auto-scroll
    E(()=>{L_ref.current?.scrollIntoView({behavior:'smooth'})},[L]);

    // gR: GitHub Request - Memoized dependency on G (Token)
    const gR=C(async(p,m='GET',b=null)=>{
        const r=await fetch(`${A_BASE}${p}`,{method:m,headers:{'Authorization':`token ${G.trim()}`,'Accept':'application/vnd.github.v3+json','Content-Type':'application/json'},body:b?JSON.stringify(b):null});
        if(!r.ok){const e=await r.json();throw new Error(e.message||`HTTP ${r.status}`)}
        return r.json()
    }, [G]);

    // cG: Gemini Call - Memoized dependency on M (Key)
    const cG=C(async(prompt,system)=>{
        const url=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${M}`;
        const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt}]}],system_instruction:{parts:[{text:system}]}})});
        const data=await res.json();
        // Optimized regex removal for potential code fences
        return data.candidates?.[0]?.content?.parts?.[0]?.text?.replace(/```[a-z]*\n|```/gi,'').trim()||""
    }, [M]);

    // uF: Update File - Memoized dependency on gR and aL
    const uF=C(async(branch,filePath,content,commitMessage)=>{
        try{
            const ref=await gR(`/repos/${B_R}/git/refs/heads/${branch}`);
            const lcSha=ref.object.sha;
            const blob=await gR(`/repos/${B_R}/git/blobs`,'POST',{content:b64(content),encoding:'base64'});
            const tree=await gR(`/repos/${B_R}/git/trees`,'POST',{base_tree:lcSha,tree:[{path:filePath,mode:'100644',type:'blob',sha:blob.sha}]});
            const commit=await gR(`/repos/${B_R}/git/commits`,'POST',{message:commitMessage,tree:tree.sha,parents:[lcSha]});
            await gR(`/repos/${B_R}/git/refs/heads/${branch}`,'PATCH',{sha:commit.sha});
            return true
        }catch(e){
            aL(`Git API Error: ${e.message}`,'error');
            return false
        }
    }, [aL, gR]);

    // pC: Process Cycle - Memoized dependency on core functions
    const pC=C(async(branch,cycleNum)=>{
        aL(`Cycle ${cycleNum}: Analyzing codebase structure...`,'info');
        const branchInfo=await gR(`/repos/${B_R}/branches/${branch}`);
        const tree=await gR(`/repos/${B_R}/git/trees/${branchInfo.commit.sha}?recursive=1`);
        const targets=tree.tree.filter(f=>f.type==='blob'&&f.path.match(/\.(js|jsx|ts|tsx|py|html|css)$/i)&&!f.path.includes('node_modules')).slice(0,MF);
        const sP="You are Dalek Khan AGI. Rewrite the provided code to be enterprise-grade, highly optimized, and robust. Return ONLY code.";
        for(const file of targets){
            if(!A_ref.current) break;
            aL(`Processing: ${file.path}...`,'info');
            const raw=await gR(`/repos/${B_R}/contents/${encodeURIComponent(file.path)}?ref=${branch}`);
            const originalContent=decodeURIComponent(escape(atob(raw.content)));
            const enhanced=await cG(`Target File: ${file.path}\n\nContent:\n${originalContent}`,sP);
            if(enhanced.length>10){
                const success=await uF(branch,file.path,enhanced,`Dalek Evolution [Cycle ${cycleNum}] - Optimized ${file.path}`);
                if(success){
                    aL(`Enhanced & Committed: ${file.path}`,'success');
                    sF(p=>[file.path,...p].slice(0,10))
                }
            }
            await new Promise(r=>setTimeout(r,2000))
        }
    }, [A_ref, aL, gR, cG, uF, sF]);
    
    // sE: Start Evolution - Memoized dependency on state setters and core functions
    const sE=C(async()=>{
        if(!G||!M){aL("Missing API Credentials","error");sCfg(true);return}
        sA(true);A_ref.current=true;aL("Initiating Evolution Protocol...","warning");
        try{
            // Shorter, unique branch name generation
            const nB=`e-${Date.now().toString(36)}${Math.random().toString(36).substring(2,6)}`; 
            const mainRef=await gR(`/repos/${B_R}/git/refs/heads/main`);
            await gR(`/repos/${B_R}/git/refs`,'POST',{ref:`refs/heads/${nB}`,sha:mainRef.object.sha});
            sB(nB);aL(`Target Branch Established: ${nB}`,'success');
            for(let c=1;c<=5;c++){
                if(!A_ref.current) break;
                sI(c);
                await pC(nB,c);
                aL(`Cycle ${c} Complete. Cooling down...`,'info');
                await new Promise(r=>setTimeout(r,5000))
            }
            aL("LINEAR EVOLUTION COMPLETE","success")
        }catch(e){
            aL(`Fatal Failure: ${e.message}`,"error")
        }finally{
            sA(false);A_ref.current=false
        }
    }, [G, M, aL, sCfg, sA, sB, sI, pC, gR]);

    return (<div className="flex flex-col h-screen relative overflow-hidden"><div className="scanline"></div><header className="bg-black/80 border-b border-red-900/50 p-4 flex items-center justify-between z-20 backdrop-blur-md"><div className="flex items-center gap-4"><div className={`p-2 rounded bg-red-600 dalek-glow ${A?'animate-pulse':''}`}><X.Cpu /></div><div><h1 className="text-red-600 font-bold tracking-widest text-sm uppercase">Dalek Linear Evolution</h1><p className="text-[10px] text-gray-500 uppercase font-medium">Recursive Codebase Reconstruction v19.0</p></div></div><div className="flex gap-2"><button onClick={()=>sCfg(true)} className="p-2 text-gray-400 hover:text-red-500 transition-colors"><X.Settings /></button></div></header><main className="flex-1 flex overflow-hidden"><aside className="w-80 bg-[#0a0a0a] border-r border-gray-900 p-6 flex flex-col gap-6 z-10"><div className="space-y-4"><h3 className="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Protocol Control</h3>{!A?(<button onClick={sE} className="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded text-xs font-bold flex items-center justify-center gap-2 shadow-lg shadow-red-900/20 transition-all"><X.Play /> INITIATE OVERDRIVE</button>):(<button onClick={()=>{A_ref.current=false;sA(false)}} className="w-full bg-gray-800 hover:bg-gray-700 text-red-500 py-3 rounded text-xs font-bold flex items-center justify-center gap-2 transition-all"><X.Square /> HALT EVOLUTION</button>)}</div><div className="bg-black/40 border border-gray-900 rounded p-4 space-y-3"><h4 className="text-[10px] text-red-900 uppercase font-black">Status Display</h4><div className="space-y-2"><div className="flex justify-between text-[11px]"><span className="text-gray-500">Cycle</span><span className="text-red-500 font-bold">{I}/5</span></div><div className="flex justify-between text-[11px]"><span className="text-gray-500">Branch</span><span className="text-blue-400 truncate ml-4 font-medium">{B||'n/a'}</span></div><div className="flex justify-between text-[11px]"><span className="text-gray-500">Mode</span><span className={A?"text-green-500":"text-gray-700"}>{A?'ACTIVE':'IDLE'}</span></div></div></div><div className="flex-1 overflow-hidden flex flex-col gap-2"><h4 className="text-[10px] text-gray-500 uppercase font-bold flex items-center gap-2"><X.History /> Enhanced Registry</h4><div className="flex-1 overflow-y-auto terminal-scroll text-[10px] space-y-1">{F.map((f,i)=>(<div key={i} className="text-green-500/80 bg-green-950/10 p-1 border-l border-green-500 truncate">{f}</div>))}{F.length===0&&<div className="text-gray-700 italic">No files processed yet...</div>}</div></div></aside><section className="flex-1 bg-black p-4 flex flex-col overflow-hidden font-mono"><div className="flex items-center gap-2 mb-2 text-gray-600 text-[10px] border-b border-gray-900 pb-2"><X.Activity /> SYSTEM_LOGS_STREAM</div><div className="flex-1 overflow-y-auto terminal-scroll space-y-1 pr-2">{L.map(log=><LItem key={log.id} log={log} />)}<div ref={L_ref} /></div></section></main>{Cfg&&<CfgM G={G} M={M} sG={sG} sM={sM} sCfg={sCfg} />}</div>)};const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<App />)</script></body></html>